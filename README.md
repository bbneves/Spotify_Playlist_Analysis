# Spotify_Playlist_Analysis

![Spotify logo](https://storage.googleapis.com/pr-newsroom-wp/1/2018/11/Spotify_Logo_CMYK_Green.png)

## Links

[Google Slide Presentation (Draft)](https://docs.google.com/presentation/d/1ixixDgI3AXCSs7oHHZay8Znu-JMH7h9iGQ141RH3gZw/edit#slide=id.p)

[Tableau Dashboard](https://public.tableau.com/views/Radar-Chart_16627764994540/SpotifyPlaylistAnalysis?:language=en-US&:display_count=n&:origin=viz_share_link)

## Selected Topic 
For this project, our team decided to perform analysis on the audio features of songs from some of the most popular Spotify playlists. We used Spotify's API to retrieve data on up to 100 songs per playlist selected, and then used a supervised learning model to predict the popularity score of a song given its audio features.

## Topic Selection Process
Our team members, **[Bruno Blaszczyk Neves](https://github.com/bbneves)**, **[Frank Bucalo](https://github.com/frankiebones)**, **[Hunter Gierhart](https://github.com/heartgears)**, and **[Tyler Comerford](https://github.com/tylerc108),** have a shared interest in music, with Hunter working at a record label. The rise in popularity of streaming services as a means to consume music has provided a plethora of new, valuable metrics to analyze, for companies, artists, and enthusiasts like us. Analysis on this data can be used as a tool to target audiences, improve reach, and uncover trends on a mass scale.

Our project centers around DSP (digital service provider) playlisting: record labels and artists have a vested interest in obtaining favorable playlisting from Spotify curators - a task that is easier said than done. These playlists drive streams and thus revenue for these parties. By analyzing audio features for songs by playlist, our group hopes to uncover useful trends for copyright owners to utilize when pitching their music for editorial placement. As the largest DSP, Spotify is the most important player in recorded music today. Their API makes more data available to the public than ever before, and is the paramount tool for music related data analysis.

## Description of data source
We scraped together the dataset that we used for this project ourselves using Spotify's API. Our finalized dataset is in the form of csv files joined in PGAdmin that contain several key metrics for each song. Metrics in our dataframe included 'danceability', 'energy', 'key', 'loudness', and 'popularity', among others. These metrics are assigned to each song by Spotify using algorithms that they've developed. While this data itself is public, details on the algorithm and the processes of generating these scores are not.

## Technologies & Requirements
* Languages: Python 3.7, SQL
* Packages (Python): Pandas, Spotipy 2.20, sklearn, tensorflow, matplotlib, psycopg2, numpy, datetime, sqlalchemy, time
* Software: PGAdmin 11, Jupyter Notebook

## Questions to answer with the data 
*Can a song's audio features predict its popularity?*

Our target variable in our machine learning model is 'popularity.' Theoretically, we want an artist to be able to predict the popularity of a song from their catalog based off of the audio features generated by Spotify. Ideally, an artist could plug the metrics of their song into our model and would in return receive a predicted popularity score that would tell them how popular they could expect their song to become based on its sound.

## Communication protocols
Our team communicated primarily via Slack, and at least twice a week via Zoom meetings on Monday and Wednesday evenings.

## Data Exploration
### Playlist Selection Criteria

We chose 100 editorial Spotify playlists of the most popular musical genres based on the following criteria:

* 100,000+ follower playlists only
* No regional playlists (“Hot Hits Brazil,” “New Music Friday Germany," etc)
* Playlists for frontline releases only (no catalog releases, i.e., “80s classic hits” or “Best of The 90s”)
* No artist-specific playlists (ex. "This Is Katy Perry")
* Ideally genre playlists (Ex. “Indie Pop,” “Sludge Rock” etc)
* No “New Music Friday” type playlists that are different every week (every playlist should have generally consistent audio features from week to week)
* No chart playlists (ex. “Top Songs Global,” “Viral Hits”)
* Editorial Playlists only (Official Spotify playlists only)

### 01. Playlist Selection

Using the criteria outlined above, 100 editorial playlists were selected and put into a csv file with their titles, number of followers, two genre identifications, and the unique URI used to request information from Spotify's API.

![playlist_df](https://github.com/bbneves/Spotify_Playlist_Analysis/blob/hunter/playlist_df.png)

### 02. Playlist Tracks

In order to pull audio features on a song, Spotify's API needs the track URI. To obtain these, we created a for loop to go through the above `playlist_df`, request the playlists tracklist and pulled each song name, lead artist name, popularity score, and track URI. These features were then stored in a separate dataframe. 

![playlisty_df2](https://github.com/bbneves/Spotify_Playlist_Analysis/blob/hunter/playlist_df2.png)

**Note:** Spotify's API only allows for 100 track pulls per playlist, so playlists with more than 100 tracks only had the first 100 tracks obtained. This affected a minority of the playlists selected, and we believe the audio features of the first 100 tracks is representative of the playlist overall.

### 03. Audio Features

The final step in obtaining our dataset was to pass the 8,100 track URIs from above to another for loop which requested audio features on each track. An example API response for a single is below:

![api_response](https://github.com/bbneves/Spotify_Playlist_Analysis/blob/hunter/api_response.png)

This information was stored in a separate dataframe, track_df. For more details on each audio feture, one can read [Spotify's API documentation](https://developer.spotify.com/documentation/web-api/reference/#/operations/get-audio-features).

![track_df](https://github.com/bbneves/Spotify_Playlist_Analysis/blob/hunter/track_df.png)

The dataframes were exported as CSV files and then imported to PGAdmin where they were joined on the song URI column. This join was necessary to predict a song's popularity score based on its audio features, as these pieces of information require different API calls and were stored in different files/dataframes.

## Data Analysis

Our initial data analysis consisted of visualizations and analyzing the audio features for correlations with each other and popularity.

![Correlation](https://github.com/bbneves/Spotify_Playlist_Analysis/blob/main/Images/corr.PNG)

![pair_grid](https://user-images.githubusercontent.com/15967377/190285086-c805d236-b088-4c28-9505-9bb7326fca89.PNG)

## Database
Our data while initially stored in two CSV files, were imported into two tables in PGAdmin using psycopg2 in Python; that work is included in file `03-add_to_SQL_Database.ipynb`. These tables were then joined into one in file `04_machine_learning.ipynb`, our Machine Learning script.

![ERD](https://user-images.githubusercontent.com/15967377/189502319-0476abf0-1143-4967-bd4f-2051f5809869.png)

## Machine Learning
### Data Pre-Processing
To begin the machine learning aspect of our anaylsis, our group set out to create a Logistic Regression model that would predict whether or not a given song would be popular. To do this, we split the data into binary groups based on the song's popularity score that we scraped from the Spotify API. Songs with a score of 60 or above were given a '1' score, which represents the popular group. Songs with a score below 60 were given a '0' score, which represents the unpopular group. We then used a Logistic Regression model to predict whether a song would be popular or unpopular based on the audio features metrics, before moving onto a neural network model. <br><br>

*UPDATE*: By evaluating the popularity in the dataset, we increased the popularity threshold to 66. This score reflects the 3rd percentile division of the dataset. 
          In order to explore more possibilities, we attempted the use of Deep Learning (More information on it below)

### Data Feature Engineering
We removed columns with names (track_uri, title, artist, etc.), and genres were encoded. Duplicate songs - the same song in multiple playlists - were dropped for this portion of the analysis. To determine feature importance, we used the correlation matrix from the Data Analysis phase to identify the most useful audio features for predicting popularity, and also looked at the distribution of popularity for each audio feature as shown below:

![popularity_distribution](https://user-images.githubusercontent.com/15967377/190285151-4a61d5b1-2d7f-4193-8130-20775849dbb2.PNG)


Based on these results, we removed the audio features `Mode` (major or minor key), `Key` (signature), `Time Signature,` and `Tempo.` Our dataset was then split into training and testing sets with a standard 75/25 split, and scaled.

### Model Choice & Results
The features we used to train the models were those we found as most correlated with popularity and/or most correlated with each other.<br>
This included danceability, energy, loudness, valence, instrumentalness and acousticness.<br><br>

Thus far, we have used logistic regression and neural network models for predicting popularity, with the latter being most successful. As we move further into the machine learning portion of our project, we also plan on exploring the data using a Random Forest classifier and other regression models to test and improve accuracy.

The Logistic Regression model is often a great starting point when working with a dichotomous dependent variable so we chose to start there. <br>
The accuracy score for our Logistic Regression model was 0.768<br>

As our data did not prove to have many linear relationships we moved to a nonlinear SVM classification model.<br>
The SVM classification model maps samples onto a high-dimensional feature space to make linear classification more possible. Our model in particular used a polynomial kernel.<br>
The accuracy score for SVM classification model was 0.748<br><br>

The neural network with 42 neurons to analyze our 18 features has delivered the best results so far, with an accuracy of .8145, surpassing our linear regression models. We plan to perform additional tests of this model using additional datasets to mitigate potential bias in the one we scraped.

![accuracy_score](https://github.com/bbneves/Spotify_Playlist_Analysis/blob/hunter/neural_accuracy.png)

*UPDATE*: 
          
          * The number of neurons were decided to be 3 times the amount of features available, 
          split into 2 times the features in the first layer and the second player having the same amount of neurons as features.
          * Evaluating the first results of .8145 accuracy, we believe there it could have some overfitting.
          * Changing the popular selection score to 66, we ran the same structure for the training. Our accuracy got down to .7553.

Activation function (AF), Loss algorithm, and optimizer choice. For the AF, the first layer with the most amount of neurons got Tanh because the dataset contains some negative variables that would've been neglected by Relu. Then, the second layer has LeakyRelu because it considers some negativity to the data. Finally, to the last layer, sigmoid was selected. Binary Crossentropy was chosen for the loss algorithm as the results are binary and it compares each of the predicted probabilities to actual class output which can be either 0 or 1. Adam optimization is stochastic gradient descent method that is based on adaptive estimation of first order and second-order moments.
        

While the neural network model is more robust than linear regression, ultimately, our model will **never** have data on all of the factors that impact popularity. There are so many factors beyond a song's composition that affect its streaming popularity, from movie and tv placements, radioplay, promotional budgets, and artist publicity, that aren't represented in our dataset.

Another technical limitation of our data is that the popularity score is not static, it is an ever changing metric. A new Harry Styles or Lizzo song may have a '0' popularity score upon release and be input in our data as such, but soar later on. Vice-versa, a song could plummet in popularity after peaking. These considerations are to say that evaluation of our model's accuracy should account for these realities.

## Dashboard
Our dataset and model are visualized in an interactive Tableau dashboard.

![Tableau](https://github.com/bbneves/Spotify_Playlist_Analysis/blob/hunter/Dashbaord_v2.png)
